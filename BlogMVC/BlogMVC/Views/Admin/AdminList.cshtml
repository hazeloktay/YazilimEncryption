@model BlogMVC.Models.ModelView.AdminListModel
@{
    ViewBag.Title = "AdminList";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
@if (Session["Username"] == null)
{
    // Giriş yapılmamış ise Login Sayfasına yönlendiriyoruz...
    HttpContext.Current.Response.Redirect("/Admin/Login");
}
else
{
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <h3><i class="fa fa-angle-right"></i>Admin Listesi</h3>

            <div class="row mt">
                <div class="col-md-12">
                    <div class="content-panel">
                        <table class="table table-striped table-advance table-hover">
                            <h4> <i class="fa fa-angle-right"></i> Adminler</h4>
                            <hr>
                            <thead>
                                <tr>
                                    <th> Ad Soyad</th>
                                    <th> Kullanıcı Adı</th>
                                    <th>Yetki</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @* Tabloyu database'den çektiğimiz admins List'i ile dolduruyoruz.*@
                                @foreach (var item in Model.admins)
                                {
                                    <tr>
                                        <td>@item.Name</td>
                                        <td>@item.Username</td>
                                        <td>@item.tblStatus.Name </td>
                                        <td>
                                            <button class="btn btn-primary btn-xs" name="@item.ID"><i class="fa fa-pencil"></i></button>
                                            <button class="btn btn-danger btn-xs btnDelete" name="@item.ID"><i class="fa fa-trash-o "></i></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div><!-- /content-panel -->
                </div><!-- /col-md-12 -->
            </div><!-- /row -->

        </section><!--/wrapper -->
    </section><!-- /MAIN CONTENT -->


}

@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $(".btnDelete").click(function () {

                var ID = $(this).attr("name");
                var closestTR = $(this).closest("tr");
                $.ajax({
                    url: '/Admin/AdminRemove/' + ID,
                    type: 'POST',
                    dataType: 'json',
                    success: function (data) {
                        alert(data);
                        if (data == "Silme işlemi başarılı") {


                        closestTR.fadeOut(1000, function () {
                            closestTR.remove();
                            });
                        }

                    },
                    error: function (hata, ajaxOptions, thrownError) {
                        alert(hata.status);
                        alert(thrownError);
                        alert(hata.responseText);
                    }
                });
            });
        });

        $('.btnEdit').click(function () {
            var ID = $(this).attr("name");
            $.confirm({
                title: 'Statu Değiştir',
                icon: 'fa fa-edit',
                content: '' +
                    '<form action="" class="formName">' +
                    '<div class="form-group">' +
                    '<select class="form-control">' +
                    '<option>Yazar</option>' +
                    '<option>Editör</option>' +
                    '<option>Admin</option>' +
                    '</select>' +
                    '</div>' +
                    '</form>',
                type: 'orange',
                buttons: {
                    formSubmit: {
                        text: 'Statu değiştir ',
                        btnClass: 'btn-warning',
                        action: function () {

                            $.ajax({
                                url: '/Admin/AdminEdit/',
                                data: {
                                    'id': ID,
                                    'statu': $('.statu').val(),
                                },
                                type: 'POST',
                                dataType: 'json',

                                success: function (data) {
                                    $.alert(data);


                                },
                                error: function (hata, ajaxOptions, thrownError) {
                                    alert(hata.status);
                                    alert(thrownError);
                                    alert(hata.responseText);
                                }
                            });
                        }
                    },
                    cancel: function () {
                        //close
                    },
                },
                onContentReady: function () {
                    // bind to events
                    var jc = this;
                    this.$content.find('form').on('submit', function (e) {
                        // if the user submits the form by pressing enter in the field.
                        e.preventDefault();
                        jc.$$formSubmit.trigger('click'); // reference the button and click it
                    });
                },
                theme: 'modern',

            });
        })

    </script>

}