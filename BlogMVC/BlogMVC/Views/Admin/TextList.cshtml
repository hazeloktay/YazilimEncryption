@model BlogMVC.Models.ModelView.TextListModel

@{


    ViewBag.Title = "TextList";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@if (Session["Username"] == null)
{
    HttpContext.Current.Response.Redirect("/Admin/Login");
}
else
{
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <div class="row mt">
                <div class="col-md-12">
                    <div class="content-panel">

                        <table class="table table-striped table-advance table-hover">
                            <h4> <i class="fa fa-angle-right"></i> Tüm Yazılar</h4>
                            <hr>
                            <thead>
                                <tr>
                                    <th>Başlık</th>
                                    <th> Yazar</th>
                                    <th>Kategori</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.texts!=null)
                                {
                                    foreach (var item in Model.texts)
                                    {
                                        <tr>
                                            <td>@item.Title</td>
                                            <td>@item.Description</td>
                                            @*<td>item.tblCategories.Name </td>*@
                                            <td>
                                                <button class="btn btn-primary btn-xs btnEdit" name="@item.ID"><i class="fa fa-pencil"></i></button>
                                                <button class="btn btn-danger btn-xs btnDelete" name="@item.ID"><i class="fa fa-trash-o "></i></button>
                                            </td>
                                        </tr>
                                    }
                                }

                            </tbody>
                        </table>

                        <div class="pageNav">
                            @*//Geri okuna tıklayınca bir önceki 10 yazıya gidecek.
                                //Eğer ilk sayfada ise ok script kodu ile gizlenecek.*@
                            <a id="prev" href="/Admin/TextList/@(Model.thisPage-1)"><span class="fa fa-angle-left"></span></a>
                            <a>@Model.thisPage</a>
                            <b>/</b>
                            <a>@Model.pageCount</a>
                            @*// İleri okuna tıklanınca bir sonraki 10 yazı gelecek.
                                //Eğer son sayfada ise ok script kodu ile gizlenecek.*@
                            <a id="next" href="/Admin/TextList/@(Model.thisPage+1)"><span class="fa fa-angle-right"></span></a>
                        </div>
                    </div><!-- /content-panel -->
                </div><!-- /col-md-12 -->
            </div><!-- /row -->

        </section><!--/wrapper -->
    </section><!-- /MAIN CONTENT -->
}
@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            var thisPage = @Model.thisPage;
            var countPage = @Model.pageCount;

            if (thisPage == 1) {
                $('#prev').hide();
            }
            if (thisPage == countPage) {
                $('#next').hide();
            }
        })
        $(".btnDelete").click(function () {

            var ID = $(this).attr("name");
            var closestTR = $(this).closest("tr");
            $.ajax({
                url: '/Admin/RemoveText/' + ID,
                type: 'POST',
                dataType: 'json',
                success: function (data) {

                    if (data == true) {
                        $.alert({
                            title: 'Başarılı!',
                            content: 'Silme işlemi başarılı.',
                            theme: 'modern',
                            type: 'green',
                            icon: 'fa fa-check'
                        });

                        closestTR.fadeOut(1000, function () {
                            closestTR.remove();
                        });

                    } else {
                        $.alert({
                            title: 'Başarısız',
                            content: 'Silme işlemi başarısız. Yetkiniz bulunmamakta...',
                            theme: 'modern',
                            type: 'red',
                            icon: 'fa fa-check'
                        });
                    }

                },
                error: function (hata, ajaxOptions, thrownError) {
                    alert(hata.status);
                    alert(thrownError);
                    alert(hata.responseText);
                }
            });
        });
    </script>

}